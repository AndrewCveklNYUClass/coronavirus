<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale = 1.0">
    <title>ðŸ‘‘ðŸ¦  COVID-19 Progression</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css"
          integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <link href="https://fonts.googleapis.com/css?family=Spartan:300,400&display=swap" rel="stylesheet">
    <script src="libs/axios/dist/axios.min.js"></script>
    <script src="libs/csvtojson/browser/csvtojson.min.js"></script>
    <script src="libs/vue/dist/vue.min.js"></script>
    <script src="libs/vue-router/dist/vue-router.min.js"></script>
    <script src="libs/chart.js/dist/Chart.bundle.min.js"></script>
    <script src="assets/js/Chart.Geo.min.js"></script>
    <script src="libs/regression-js/dist/regression.min.js"></script>
    <script src="bower_components/moment/min/moment.min.js"></script>
    <script src="assets/js/lm_fitter.js"></script>
</head>
<body>

<!--
<div style="background-color: blanchedalmond; height: 500px; width: 800px; margin: auto;">
    <div style="background-color: #5cb85c; height: 400px; float: left; width: 200px;"></div>
    <div style="background-color: #2793db; height: 400px;"></div>
    <div style="clear: both;"></div>
</div>
-->

<div class="main">

    <div id="everything_except_footer" class="everything-except-footer">

        <div id="header" class="header">
            <div class="container">
                <h1>COVID-19 Progression</h1>
            </div>
        </div>

        <div id="aggregation_section" class="container">

            <div id="app" class="sidebar">

                <div id="geography_picker"
                     class="modifiers pure-menu pure-menu-scrollable custom-restricted settings-block geography-picker">
                    <ul class="pure-menu-list">
                        <li class="pure-menu-list-item">
                            <input id="cruise_ship_descendants" type="checkbox" v-model="includeCruiseShipDescendants"/>
                            <label for="cruise_ship_descendants" style="font-style: italic;">Abroad from Cruise Ship
                                (Modifier)</label>
                        </li>
                        <li class="pure-menu-list-item">
                            <input id="select_all_checkbox" type="checkbox" v-model="selectAll"
                                   :indeterminate.prop="partialSelection"/>
                            <label for="select_all_checkbox" style="text-transform: uppercase">Select All</label>
                        </li>
                        <li class="pure-menu-list-item" v-for="country in sortedCountries">
                            <input type="checkbox" v-bind:id="country" v-bind:value="country"
                                   v-model="checkedCountries"/>
                            <label v-bind:for="country">{{formatCountry(country)}}</label>
                        </li>
                    </ul>
                </div>

                <div id="aggregation_configuration" class="aggregation-configuration">
                    <div id="config" class="settings-block pure-menu config">
                        <ul class="pure-menu-list">
                            <li class="pure-menu-list-item">
                                <input id="cases_checkbox" type="checkbox" v-model="showCases"/>
                                <label for="cases_checkbox">Cases</label>
                                <br/>
                                <input id="recoveries_checkbox" type="checkbox" v-model="showRecoveries"/>
                                <label for="recoveries_checkbox">Recoveries</label>
                                <br/>
                                <input id="deaths_checkbox" type="checkbox" v-model="showDeaths"/>
                                <label for="deaths_checkbox">Deaths</label>
                            </li>
                            <li class="pure-menu-list-item">
                                <input type="radio" id="joint_axis_radio" name="axes" v-model="axes" value="joint"/>
                                <label for="joint_axis_radio">One Axis</label>
                                <input type="radio" id="separate_axes_radio" name="axes" v-model="axes" value="separate"
                                       :disabled="!canSeparateAxes"/>
                                <label for="separate_axes_radio">Two Axes</label>
                            </li>
                            <li class="pure-menu-list-item" v-if="canShowLogScale">
                                <input type="radio" id="linear_scale_radio" name="scale" v-model="scale"
                                       value="linear"/>
                                <label for="linear_scale_radio">Linear Scale</label>
                                <input type="radio" id="log_scale_radio" name="scale" v-model="scale" value="log"
                                       :disabled="!canShowLogScale"/>
                                <label for="log_scale_radio">Log Scale</label>
                            </li>
                            <li class="pure-menu-list-item">
                                <input type="radio" id="total_radio" name="derivative" v-model="derivative"
                                       v-bind:value="false"/>
                                <label for="total_radio">Total</label>
                                <input type="radio" id="delta_radio" name="derivative" v-model="derivative"
                                       v-bind:value="true"/>
                                <label for="delta_radio">Delta</label>
                            </li>
                            <li class="pure-menu-list-item">
                                <select id="regression" v-model="regression" v-if="canShowRegression"
                                        :disabled="!canShowRegression">
                                    <option value="none">Choose Regression Model</option>
                                    <option value="exponential">Exponential</option>
                                    <option value="logistic">Logistic (Experimental)</option>
                                </select>
                            </li>
                        </ul>
                    </div>

                    <div id="details" class="settings-block" v-if="regression !== 'none'">
                        <div id="regression_details" class="pure-menu">
                            <ul class="pure-menu-list">
                                <li class="pure-menu-list-item">
                                    <label>Extrapolation Size: {{extrapolationSize}}</label>
                                    <input type="range" v-model="extrapolationSize" min="2" max="10"/>
                                </li>
                                <li class="pure-menu-list-item">
                                    <label>Model Offset: {{modelOffset}}</label>
                                    <input type="range" v-model="modelOffset" v-bind:min="regressionOffsetMinimum"
                                           v-bind:max="regressionOffsetMaximum"/>
                                </li>
                                <li class="pure-menu-list-item" v-if="regression === 'exponential'">Equation: f(x) =
                                    {{regressionSeries.cases.equation[0]}}e<sup>{{regressionSeries.cases.equation[1]}}x</sup>
                                </li>
                                <li class="pure-menu-list-item" v-if="regression === 'logistic'">Equation: f(x) =
                                    {{Math.round(regressionSeries.cases.parameterValues[0])}} / (1 +
                                    {{Math.round(regressionSeries.cases.parameterValues[1])}}e<sup>{{Math.round(regressionSeries.cases.parameterValues[2]*100)/100}}x</sup>)
                                </li>
                                <li class="pure-menu-list-item" v-if="regression === 'exponential'">R<sup>2</sup>:
                                    {{regressionSeries.cases.r2}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="chart_container">
                    <canvas id="graph_canvas" style="width: 100%;" xclass="pure-u-5-6"></canvas>
                </div>

                <div style="clear: both;"></div>

            </div>


        </div>
        <!-- <div>
            <span>Data: <a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series">https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series</a></span>
            <span>Source: <a href="https://github.com/arik-so/coronavirus/tree/gh-pages">https://github.com/arik-so/coronavirus/tree/gh-pages</a></span>
        </div> -->

        <div id="map_section" class="container">
            <canvas id="map"></canvas>
        </div>

    </div>

    <div id="footer" class="footer">
        <div class="container footer-container">
            <p>Last updated: 3/02/2020</p>
            <p><a href="https://github.com/arik-so/coronavirus/tree/gh-pages" target="_blank">Github</a> | <a
                    href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series"
                    target="_blank">Data</a></p>
            <p>Built wearing ðŸ˜· by <a href="https://twitter.com/arikaleph" target="_blank">@arikaleph</a> and <a
                    href="https://twitter.com/elliebee" target="_blank">@elliebee</a>.</p>
        </div>
    </div>

</div>

<script type="application/javascript">

    (async () => {

        const data = (await axios({
            method: 'get',
            url: 'https://unpkg.com/world-atlas/countries-50m.json',
        })).data;

        const us = (await axios({
            method: 'get',
            url: 'https://unpkg.com/us-atlas/states-10m.json',
        })).data;
        const countries = ChartGeo.topojson.feature(data, data.objects.countries).features;
        const states = ChartGeo.topojson.feature(us, us.objects.states).features;

        const countryData = countries.filter((f) => f.properties.name !== 'Antarctica' && f.properties.name !== 'United States of America').map((d) => ({feature: d, value: Math.random()}));
        const statesData = states.map((d) => ({feature: d, value: Math.random()}));

        const Austria = countries.find((d) => d.properties.name === 'Austria');
        const Germany = countries.find((d) => d.properties.name === 'Germany');

        const countryLabels = countries.map((d) => d.properties.name);
        const stateLabels = states.map((d) => d.properties.name);
        const chart = new Chart(document.getElementById("map").getContext("2d"), {
            type: 'choropleth',
            data: {
                labels: [...countryLabels, ...stateLabels],
                // labels: ['Germany', 'Austria'],
                datasets: [{
                    label: 'Countries',
                    /*backgroundColor: (context) => {
                        if (context.dataIndex == null) {
                            return null;
                        }
                        const value = context.dataset.data[context.dataIndex];
                        return new Color('steelblue').lightness(value.value * 100).rgbString();
                    },*/
                    data: [...countryData, ...statesData]
                }]
            },
            options: {
                maintainAspectRatio: false,
                showOutline: false,
                // outline: [...countryData],
                showGraticule: true,
                legend: {
                    display: false
                },
                scale: {
                    projection: 'mercator'
                }
            }
        });

    })();

</script>


<script src="./app.js"></script>
</body>
</html>
